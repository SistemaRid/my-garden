<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Garden</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100%;
      padding-bottom: 100px;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
      padding: 24px 20px;
      border-radius: 0 0 24px 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
      margin-bottom: 20px;
    }

    .site-title {
      font-family: 'Brush Script MT', cursive;
      font-size: 42px;
      text-align: center;
      background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .carousel-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      transition: all 0.3s;
    }

    .dot.active {
      background: white;
      width: 24px;
      border-radius: 4px;
    }

    /* Main Content */
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* Gallery Grid */
    .gallery {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 20px;
    }

    .plant-card {
      aspect-ratio: 1;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
      background: white;
    }

    .plant-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .plant-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .plant-card-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
      padding: 12px;
      color: white;
    }

    .plant-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .plant-age {
      font-size: 12px;
      opacity: 0.9;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }

    .empty-message {
      font-size: 20px;
      color: #666;
      margin-bottom: 30px;
    }

    /* Buttons */
    .btn-primary {
      background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
      padding: 12px 24px;
      border-radius: 32px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      display: flex;
      gap: 32px;
      z-index: 1000;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: transform 0.2s;
      color: white;
    }

    .nav-item:hover {
      transform: scale(1.1);
    }

    .nav-item.active {
      transform: scale(1.15);
    }

    .nav-icon {
      font-size: 24px;
    }

    .nav-label {
      font-size: 10px;
      font-weight: 500;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 24px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #666;
      line-height: 1;
      padding: 0;
      width: 32px;
      height: 32px;
    }

    /* Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: #8B5CF6;
    }

    textarea.form-input {
      min-height: 100px;
      resize: vertical;
    }

    .photo-upload {
      border: 2px dashed #e5e7eb;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .photo-upload:hover {
      border-color: #8B5CF6;
      background: #f9fafb;
    }

    .photo-upload input {
      display: none;
    }

    .photo-preview {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 12px;
    }

    /* Plant Detail Page */
    .plant-detail-header {
      position: relative;
      height: 300px;
      border-radius: 24px;
      overflow: hidden;
      margin-bottom: 24px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .plant-detail-header img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .plant-detail-info {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      padding: 24px;
      color: white;
    }

    .plant-detail-name {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .plant-detail-meta {
      display: flex;
      gap: 16px;
      font-size: 14px;
      opacity: 0.9;
    }

    /* Timeline */
    .timeline {
      position: relative;
      padding-left: 40px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, #8B5CF6 0%, #FCD34D 100%);
    }

    .timeline-item {
      position: relative;
      margin-bottom: 32px;
      background: white;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -33px;
      top: 20px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #8B5CF6;
      border: 3px solid white;
      box-shadow: 0 0 0 2px #8B5CF6;
    }

    .timeline-date {
      font-size: 12px;
      color: #8B5CF6;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .timeline-type {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .timeline-description {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }

    .timeline-photo {
      width: 100%;
      border-radius: 12px;
      margin-top: 12px;
    }

    /* AI Diagnosis Page */
    .diagnosis-wizard {
      background: white;
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }

    .wizard-step {
      display: none;
    }

    .wizard-step.active {
      display: block;
    }

    .step-title {
      font-size: 22px;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      text-align: center;
    }

    .option-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .option-card {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .option-card:hover {
      border-color: #8B5CF6;
      background: #f5f3ff;
      transform: translateY(-2px);
    }

    .option-card.selected {
      border-color: #8B5CF6;
      background: linear-gradient(135deg, #8B5CF6 0%, #FCD34D 100%);
      color: white;
    }

    .option-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .option-label {
      font-size: 14px;
      font-weight: 600;
    }

    .diagnosis-result {
      background: white;
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }

    .severity-badge {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .severity-low { background: #D1FAE5; color: #065F46; }
    .severity-medium { background: #FEF3C7; color: #92400E; }
    .severity-high { background: #FEE2E2; color: #991B1B; }

    .treatment-section {
      margin-top: 24px;
    }

    .treatment-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .treatment-card {
      background: #f9fafb;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .treatment-name {
      font-size: 16px;
      font-weight: 600;
      color: #8B5CF6;
      margin-bottom: 8px;
    }

    .treatment-steps {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }

    .treatment-price {
      font-size: 12px;
      color: #059669;
      font-weight: 600;
      margin-top: 8px;
    }

    /* Page Container */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .fab {
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8B5CF6 0%, #FCD34D 100%);
      color: white;
      border: none;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      transition: transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .fab:hover {
      transform: scale(1.1);
    }

    .back-btn {
      background: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 16px;
      font-size: 20px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-secondary {
      flex: 1;
      background: white;
      color: #8B5CF6;
      border: 2px solid #8B5CF6;
      padding: 12px 24px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: #8B5CF6;
      color: white;
    }

    .progress-bar {
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      margin-bottom: 24px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
      transition: width 0.3s;
    }

    /* SVG Icons */
    .icon-outline {
      width: 24px;
      height: 24px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .symptom-list {
      list-style: none;
      padding: 0;
    }

    .symptom-item {
      background: #f9fafb;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
    }

    .symptom-item:hover {
      border-color: #8B5CF6;
      background: #f5f3ff;
    }

    .symptom-item.selected {
      border-color: #8B5CF6;
      background: #f5f3ff;
    }

    .symptom-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid #8B5CF6;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .symptom-item.selected .symptom-checkbox {
      background: #8B5CF6;
      color: white;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Home Page -->
  <div id="homePage" class="page active">
   <div class="header">
    <h1 class="site-title" id="siteTitle">My Garden</h1>
    <div class="carousel-dots">
     <div class="dot active"></div>
     <div class="dot"></div>
     <div class="dot"></div>
    </div>
   </div>
   <div class="container">
    <div id="galleryContainer"></div>
   </div><button class="fab" onclick="showAddPlantModal()">
    <svg class="icon-outline" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg></button>
  </div><!-- Plant Detail Page -->
  <div id="plantDetailPage" class="page">
   <div class="container"><button class="back-btn" onclick="showPage('homePage')">
     <svg class="icon-outline" viewbox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line> <polyline points="12 19 5 12 12 5"></polyline>
     </svg></button>
    <div id="plantDetailContent"></div>
   </div><button class="fab" onclick="showAddEventModal()">
    <svg class="icon-outline" viewbox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line> <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg></button>
  </div><!-- AI Diagnosis Page -->
  <div id="diagnosisPage" class="page">
   <div class="container"><button class="back-btn" onclick="showPage('homePage')">
     <svg class="icon-outline" viewbox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line> <polyline points="12 19 5 12 12 5"></polyline>
     </svg></button>
    <h2 class="section-title">
     <svg class="icon-outline" viewbox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path> <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline> <polyline points="7.5 19.79 7.5 14.6 3 12"></polyline> <polyline points="21 12 16.5 14.6 16.5 19.79"></polyline> <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline> <line x1="12" y1="22.08" x2="12" y2="12"></line>
     </svg> Diagn√≥stico Inteligente</h2>
    <div class="diagnosis-wizard">
     <div class="wizard-step active" id="step1">
      <div class="step-title">
       Descreva o problema da sua planta
      </div>
      <p style="text-align: center; color: #666; margin-bottom: 24px; font-size: 14px;">Conte o que est√° acontecendo: tipo de planta, sintomas, cores, etc.</p>
      <div class="form-group"><label class="form-label">Descreva o problema</label> <textarea class="form-input" id="problemDescription" placeholder="Ex: Minha rosa est√° com folhas amarelas come√ßando de baixo, algumas est√£o caindo e o solo est√° sempre √∫mido. Inclua o tipo de planta na descri√ß√£o se souber." style="min-height: 150px;" required></textarea>
      </div>
      <div class="form-group"><label class="form-label">Foto do Problema (opcional)</label>
       <div class="photo-upload" onclick="document.getElementById('problemPhoto').click()">
        <svg class="icon-outline" viewbox="0 0 24 24" style="width: 48px; height: 48px; margin: 0 auto 12px; color: #8B5CF6;"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect> <circle cx="8.5" cy="8.5" r="1.5"></circle> <polyline points="21 15 16 10 5 21"></polyline>
        </svg>
        <p style="color: #666;">Clique para adicionar foto</p><input type="file" id="problemPhoto" accept="image/*" onchange="previewPhoto(this, 'problemPhotoPreview')">
       </div><img id="problemPhotoPreview" class="photo-preview" style="display: none;">
      </div><button class="btn-primary" style="width: 100%;" onclick="analyzeFreeTextDiagnosis()">
       <svg class="icon-outline" viewbox="0 0 24 24" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path> <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline> <line x1="12" y1="22.08" x2="12" y2="12"></line>
       </svg> Analisar com IA </button>
     </div>
    </div>
    <div id="diagnosisResult"></div>
   </div>
  </div><!-- Add Plant Modal -->
  <div id="addPlantModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title">Adicionar Planta</h2><button class="close-btn" onclick="closeModal('addPlantModal')">√ó</button>
    </div>
    <form id="addPlantForm" onsubmit="addPlant(event)">
     <div class="form-group"><label class="form-label">Foto da Planta</label>
      <div class="photo-upload" onclick="document.getElementById('plantPhoto').click()">
       <svg class="icon-outline" viewbox="0 0 24 24" style="width: 48px; height: 48px; margin: 0 auto 12px; color: #8B5CF6;"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect> <circle cx="8.5" cy="8.5" r="1.5"></circle> <polyline points="21 15 16 10 5 21"></polyline>
       </svg>
       <p style="color: #666;">Clique para adicionar foto</p><input type="file" id="plantPhoto" accept="image/*" onchange="previewPhoto(this, 'plantPhotoPreview')">
      </div><img id="plantPhotoPreview" class="photo-preview" style="display: none;">
     </div>
     <div class="form-group"><label class="form-label">Nome da Planta</label> <input type="text" class="form-input" id="plantName" placeholder="Ex: Rosa Vermelha" required>
     </div>
     <div class="form-group"><label class="form-label">Data de Plantio</label> <input type="date" class="form-input" id="plantDate" required>
     </div>
     <div class="form-group"><label class="form-label">Observa√ß√µes (opcional)</label> <textarea class="form-input" id="plantNotes" placeholder="Notas sobre a planta..."></textarea>
     </div><button type="submit" class="btn-primary" style="width: 100%;">Adicionar Planta</button>
    </form>
   </div>
  </div><!-- Add Event Modal -->
  <div id="addEventModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h2 class="modal-title">Adicionar Evento</h2><button class="close-btn" onclick="closeModal('addEventModal')">√ó</button>
    </div>
    <form id="addEventForm" onsubmit="addEvent(event)">
     <div class="form-group"><label class="form-label">Tipo de Evento</label> <select class="form-input" id="eventType" required> <option value="">Selecione...</option> <option value="poda">üåø Poda</option> <option value="vaso">ü™¥ Troca de Vaso</option> <option value="adubo">üå± Aduba√ß√£o</option> <option value="rega">üíß Rega Especial</option> <option value="problema">‚ö†Ô∏è Problema Detectado</option> <option value="foto">üì∏ Foto de Desenvolvimento</option> <option value="nota">üìù Nota Geral</option> </select>
     </div>
     <div class="form-group"><label class="form-label">Data</label> <input type="date" class="form-input" id="eventDate" required>
     </div>
     <div class="form-group"><label class="form-label">Foto (opcional)</label>
      <div class="photo-upload" onclick="document.getElementById('eventPhoto').click()">
       <svg class="icon-outline" viewbox="0 0 24 24" style="width: 48px; height: 48px; margin: 0 auto 12px; color: #8B5CF6;"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect> <circle cx="8.5" cy="8.5" r="1.5"></circle> <polyline points="21 15 16 10 5 21"></polyline>
       </svg>
       <p style="color: #666;">Clique para adicionar foto</p><input type="file" id="eventPhoto" accept="image/*" onchange="previewPhoto(this, 'eventPhotoPreview')">
      </div><img id="eventPhotoPreview" class="photo-preview" style="display: none;">
     </div>
     <div class="form-group"><label class="form-label">Descri√ß√£o</label> <textarea class="form-input" id="eventDescription" placeholder="Descreva o evento..." required></textarea>
     </div><button type="submit" class="btn-primary" style="width: 100%;">Adicionar Evento</button>
    </form>
   </div>
  </div><!-- Bottom Navigation -->
  <div class="bottom-nav">
   <div class="nav-item active" onclick="showPage('homePage')">
    <svg class="icon-outline nav-icon" viewbox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline>
    </svg><span class="nav-label">Home</span>
   </div>
   <div class="nav-item" onclick="showPage('homePage')">
    <svg class="icon-outline nav-icon" viewbox="0 0 24 24"><path d="M12 2v20M2 12h20"></path> <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
    </svg><span class="nav-label">Plantas</span>
   </div>
   <div class="nav-item" onclick="showPage('diagnosisPage')">
    <svg class="icon-outline nav-icon" viewbox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle> <path d="m21 21-4.35-4.35"></path>
    </svg><span class="nav-label">IA</span>
   </div>
  </div>
  <script>
    // Initialize
    let plants = JSON.parse(localStorage.getItem('myGardenPlants')) || [];
    let currentPlantId = null;
    let diagnosisData = {
      plantType: '',
      affectedPart: '',
      symptoms: []
    };

    const defaultConfig = {
      site_title: "My Garden",
      empty_message: "Adicione sua primeira planta!",
      add_button_text: "Adicionar Planta"
    };

    let config = { ...defaultConfig };

    // Knowledge Base - Comprehensive Plant Problem Database
    const knowledgeBase = {
      rosa: {
        folhas: {
          amarelas_base: {
            name: 'Excesso de √Ågua',
            severity: 'medium',
            cause: 'Rega excessiva causando apodrecimento das ra√≠zes',
            symptoms: ['Folhas amarelas come√ßando de baixo', 'Folhas caindo facilmente', 'Solo sempre √∫mido'],
            treatments: {
              free: [
                {
                  name: 'Reduzir Rega Imediatamente',
                  recipe: 'Sem ingredientes necess√°rios',
                  steps: 'Pare de regar por 5-7 dias. Deixe o solo secar completamente entre regas. Verifique se o vaso tem furos de drenagem.',
                  frequency: 'Regar apenas quando o solo estiver seco ao toque'
                },
                {
                  name: 'Melhorar Drenagem',
                  recipe: 'Terra + areia grossa (propor√ß√£o 2:1)',
                  steps: 'Se poss√≠vel, replante em substrato mais drenante. Adicione areia grossa ou perlita √† terra.',
                  frequency: 'Uma vez'
                }
              ],
              cheap: [
                {
                  name: 'Enraizador Natural',
                  price: 'R$ 8-15',
                  usage: 'Aplique conforme instru√ß√µes para estimular novas ra√≠zes saud√°veis.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          manchas_pretas: {
            name: 'Mancha Preta (Fungo)',
            severity: 'high',
            cause: 'Fungo Diplocarpon rosae, comum em ambientes √∫midos',
            symptoms: ['Manchas pretas circulares nas folhas', 'Folhas amarelando ao redor das manchas', 'Queda prematura de folhas'],
            treatments: {
              free: [
                {
                  name: 'Remo√ß√£o Manual',
                  recipe: 'Tesoura limpa + √°lcool 70%',
                  steps: 'Remova TODAS as folhas infectadas. Limpe a tesoura com √°lcool entre cada corte. Descarte as folhas no lixo (n√£o no composto).',
                  frequency: 'Imediatamente e diariamente por 2 semanas'
                },
                {
                  name: 'Ch√° de Canela',
                  recipe: '2 colheres de canela em p√≥ + 1 litro de √°gua fervente',
                  steps: 'Ferva a √°gua, adicione canela, deixe esfriar. Coe e borrife nas folhas saud√°veis pela manh√£.',
                  frequency: 'A cada 3 dias por 3 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Fungicida √† Base de Cobre',
                  price: 'R$ 15-25',
                  usage: 'Aplique conforme instru√ß√µes, geralmente a cada 7-10 dias.',
                  where: 'Lojas agropecu√°rias ou jardinagem'
                }
              ]
            }
          },
          pulgoes: {
            name: 'Infesta√ß√£o de Pulg√µes',
            severity: 'medium',
            cause: 'Insetos sugadores de seiva, atra√≠dos por brotos novos',
            symptoms: ['Pequenos insetos verdes/pretos nos brotos', 'Folhas enroladas', 'Subst√¢ncia pegajosa nas folhas'],
            treatments: {
              free: [
                {
                  name: 'Jato de √Ågua Forte',
                  recipe: '√Ågua limpa',
                  steps: 'Use mangueira com jato forte ou chuveirinho. Mire nos pulg√µes, especialmente na parte de baixo das folhas. Fa√ßa pela manh√£.',
                  frequency: 'Diariamente por 1 semana'
                },
                {
                  name: '√Ågua com Sab√£o Neutro',
                  recipe: '1 litro de √°gua + 1 colher de sopa de sab√£o neutro',
                  steps: 'Misture bem. Borrife generosamente em todas as folhas, especialmente embaixo. Deixe agir 30 minutos e enx√°gue.',
                  frequency: 'A cada 3 dias por 2 semanas'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Dilua 5ml em 1 litro de √°gua. Borrife √† noite. Repita semanalmente.',
                  where: 'Lojas de jardinagem ou online'
                }
              ]
            }
          },
          cochonilhas: {
            name: 'Cochonilhas',
            severity: 'high',
            cause: 'Insetos que sugam seiva e secretam subst√¢ncia pegajosa',
            symptoms: ['Pequenos insetos brancos/marrons grudados', 'Subst√¢ncia pegajosa nas folhas', 'Folhas amareladas', 'Fumagina (fungo preto)'],
            treatments: {
              free: [
                {
                  name: 'Remo√ß√£o Manual com √Ålcool',
                  recipe: '√Ålcool 70% + cotonete',
                  steps: 'Molhe o cotonete no √°lcool e passe em CADA cochonilha para mat√°-las. Fa√ßa isso com cuidado em todas as folhas e caule.',
                  frequency: 'Diariamente por 2 semanas'
                },
                {
                  name: 'Calda de Fumo',
                  recipe: '1 cigarro de fumo de corda + 1 litro de √°gua + 1 colher de sab√£o',
                  steps: 'Deixe o fumo de molho na √°gua por 24h. Coe, adicione sab√£o e borrife. CUIDADO: use luvas, √© t√≥xico!',
                  frequency: 'A cada 5 dias por 3 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Inseticida Sist√™mico',
                  price: 'R$ 20-35',
                  usage: 'Aplicar conforme instru√ß√µes. Mata cochonilhas de dentro da planta.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          acaros: {
            name: '√Åcaros (√Åcaro Rajado)',
            severity: 'high',
            cause: '√Åcaros microsc√≥picos que sugam seiva, proliferam em tempo seco',
            symptoms: ['Pontos amarelos/brancos nas folhas', 'Teias finas entre folhas', 'Folhas secas e quebradi√ßas', 'Folhas prateadas'],
            treatments: {
              free: [
                {
                  name: 'Aumentar Umidade',
                  recipe: '√Ågua + borrifador',
                  steps: '√Åcaros ODEIAM umidade. Borrife √°gua nas folhas 2-3x ao dia. Coloque um prato com √°gua perto da planta.',
                  frequency: '2-3x ao dia por 2 semanas'
                },
                {
                  name: 'Ch√° de Alho',
                  recipe: '5 dentes de alho + 1 litro de √°gua',
                  steps: 'Bata o alho com √°gua no liquidificador. Deixe descansar 24h, coe e borrife nas folhas (especialmente embaixo).',
                  frequency: 'A cada 3 dias por 3 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Acaricida Espec√≠fico',
                  price: 'R$ 25-40',
                  usage: 'Inseticidas comuns N√ÉO matam √°caros. Use acaricida espec√≠fico.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          lagartas: {
            name: 'Lagartas',
            severity: 'medium',
            cause: 'Larvas de borboletas/mariposas que comem folhas',
            symptoms: ['Buracos grandes nas folhas', 'Folhas comidas nas bordas', 'Presen√ßa de lagartas verdes/marrons', 'Fezes escuras nas folhas'],
            treatments: {
              free: [
                {
                  name: 'Cata√ß√£o Manual',
                  recipe: 'Luvas',
                  steps: 'Procure lagartas de manh√£ cedo ou √† noite. Remova manualmente e descarte longe. Verifique embaixo das folhas.',
                  frequency: 'Diariamente por 2 semanas'
                },
                {
                  name: 'Bacillus thuringiensis Caseiro',
                  recipe: 'Folhas de tomate ou batata',
                  steps: 'Ferva 1 x√≠cara de folhas de tomate em 2 x√≠caras de √°gua. Deixe esfriar, coe e borrife. √â t√≥xico para lagartas.',
                  frequency: 'A cada 5 dias'
                }
              ],
              cheap: [
                {
                  name: 'Bacillus thuringiensis (Bt)',
                  price: 'R$ 15-25',
                  usage: 'Inseticida biol√≥gico espec√≠fico para lagartas. Seguro para humanos e abelhas.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          tripes: {
            name: 'Tripes',
            severity: 'medium',
            cause: 'Insetos min√∫sculos que raspam e sugam c√©lulas das folhas',
            symptoms: ['Manchas prateadas nas folhas', 'Folhas deformadas', 'Pequenos insetos pretos/amarelos', 'Pontos pretos (fezes)'],
            treatments: {
              free: [
                {
                  name: 'Armadilha Adesiva Azul',
                  recipe: 'Papel azul + √≥leo ou mel',
                  steps: 'Tripes s√£o atra√≠dos pela cor azul. Passe √≥leo/mel em papel azul e coloque perto da planta. Eles grudam.',
                  frequency: 'Trocar a cada 3 dias'
                },
                {
                  name: 'Sab√£o de Pot√°ssio',
                  recipe: '2 colheres de sab√£o neutro + 1 litro de √°gua',
                  steps: 'Misture e borrife abundantemente, especialmente embaixo das folhas. Enx√°gue ap√≥s 1 hora.',
                  frequency: 'A cada 3 dias por 2 semanas'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Muito eficaz contra tripes. Dilua e borrife √† noite.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          brancas_po: {
            name: 'O√≠dio (Mofo Branco)',
            severity: 'medium',
            cause: 'Fungo que se desenvolve em ambientes √∫midos com pouca circula√ß√£o',
            symptoms: ['P√≥ branco nas folhas', 'Folhas deformadas', 'Crescimento lento'],
            treatments: {
              free: [
                {
                  name: 'Bicarbonato de S√≥dio',
                  recipe: '1 colher de ch√° de bicarbonato + 1 litro de √°gua + 1 colher de ch√° de √≥leo vegetal',
                  steps: 'Misture bem todos os ingredientes. Borrife nas folhas afetadas. Aplique em dias nublados ou √† tarde.',
                  frequency: 'A cada 5 dias por 3 semanas'
                },
                {
                  name: 'Leite Dilu√≠do',
                  recipe: '1 parte de leite + 9 partes de √°gua',
                  steps: 'Misture e borrife nas folhas. O leite cria um ambiente hostil para o fungo.',
                  frequency: 'A cada 3 dias por 2 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Enxofre Fungicida',
                  price: 'R$ 12-20',
                  usage: 'Aplique conforme instru√ß√µes. Muito eficaz contra o√≠dio.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          moscas_brancas: {
            name: 'Mosca Branca',
            severity: 'high',
            cause: 'Pequenas moscas que sugam seiva e transmitem v√≠rus',
            symptoms: ['Nuvem de mosquinhas brancas ao tocar', 'Folhas amareladas', 'Subst√¢ncia pegajosa', 'Crescimento atrofiado'],
            treatments: {
              free: [
                {
                  name: 'Armadilha Adesiva Amarela',
                  recipe: 'Papel amarelo + √≥leo ou mel',
                  steps: 'Moscas brancas s√£o atra√≠das por amarelo. Passe √≥leo/mel em papel amarelo e pendure perto da planta.',
                  frequency: 'Trocar a cada 2-3 dias'
                },
                {
                  name: 'Aspirador de P√≥',
                  recipe: 'Aspirador port√°til',
                  steps: 'De manh√£ cedo (quando est√£o lentas), aspire suavemente as moscas das folhas. Descarte o saco imediatamente.',
                  frequency: 'Diariamente por 1 semana'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem + Sab√£o',
                  price: 'R$ 18-30',
                  usage: 'Mata adultos e larvas. Aplicar a cada 5 dias por 3 semanas.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          }
        },
        flores: {
          nao_abre: {
            name: 'Bot√µes N√£o Abrem',
            severity: 'low',
            cause: 'Falta de nutrientes, especialmente f√≥sforo, ou estresse h√≠drico',
            symptoms: ['Bot√µes formam mas n√£o abrem', 'Bot√µes secam antes de abrir', 'Crescimento lento'],
            treatments: {
              free: [
                {
                  name: 'Casca de Banana (F√≥sforo)',
                  recipe: 'Cascas de 2-3 bananas',
                  steps: 'Corte as cascas em peda√ßos pequenos e enterre ao redor da planta (5cm de profundidade). Ou fa√ßa ch√°: ferva as cascas em 1L de √°gua, deixe esfriar e regue.',
                  frequency: 'A cada 15 dias'
                },
                {
                  name: 'Ajuste de Rega',
                  recipe: '√Ågua',
                  steps: 'Rosas precisam de rega consistente. Regue profundamente 2-3x por semana, mantendo solo √∫mido mas n√£o encharcado.',
                  frequency: '2-3x por semana'
                }
              ],
              cheap: [
                {
                  name: 'Adubo NPK 4-14-8',
                  price: 'R$ 10-18',
                  usage: 'Rico em f√≥sforo (n√∫mero do meio). Aplique conforme instru√ß√µes da embalagem.',
                  where: 'Qualquer loja de jardinagem'
                }
              ]
            }
          }
        }
      },
      rosa_deserto: {
        folhas: {
          amarelas: {
            name: 'Excesso de √Ågua',
            severity: 'high',
            cause: 'Rosa do deserto √© suculenta e apodrece facilmente com excesso de √°gua',
            symptoms: ['Folhas amarelas', 'Caule mole', 'Folhas caindo'],
            treatments: {
              free: [
                {
                  name: 'PARE DE REGAR IMEDIATAMENTE',
                  recipe: 'Sem ingredientes',
                  steps: 'Pare completamente de regar. Remova a planta do vaso e verifique as ra√≠zes. Se estiverem marrons/moles, corte as partes podres com tesoura limpa. Deixe secar ao ar por 2-3 dias antes de replantar.',
                  frequency: 'A√ß√£o √∫nica'
                },
                {
                  name: 'Substrato Drenante',
                  recipe: '50% terra + 30% areia grossa + 20% pedriscos',
                  steps: 'Replante em substrato MUITO drenante. Rosa do deserto precisa de solo que seque r√°pido.',
                  frequency: 'Uma vez'
                }
              ],
              cheap: [
                {
                  name: 'Substrato para Cactos',
                  price: 'R$ 8-15',
                  usage: 'Use substrato pronto para cactos e suculentas. J√° vem com drenagem ideal.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          caindo: {
            name: 'Falta de Luz Solar',
            severity: 'medium',
            cause: 'Rosa do deserto precisa de SOL PLENO (6-8h diretas por dia)',
            symptoms: ['Folhas caindo sem amarelas', 'Crescimento fraco', 'Caule fino'],
            treatments: {
              free: [
                {
                  name: 'Mudan√ßa de Local',
                  recipe: 'Sem ingredientes',
                  steps: 'Mova para local com SOL DIRETO m√≠nimo 6 horas por dia. Rosa do deserto AMA sol forte. Fa√ßa a mudan√ßa gradual (1h a mais por dia) para n√£o queimar.',
                  frequency: 'Permanente'
                }
              ],
              cheap: []
            }
          },
          cochonilhas_rosa_deserto: {
            name: 'Cochonilhas em Rosa do Deserto',
            severity: 'high',
            cause: 'Insetos que se escondem no caudex e folhas',
            symptoms: ['Insetos brancos tipo algod√£o', 'Subst√¢ncia pegajosa', 'Folhas amareladas', 'Fumagina preta'],
            treatments: {
              free: [
                {
                  name: '√Ålcool 70% Direto',
                  recipe: '√Ålcool 70% + cotonete',
                  steps: 'Molhe cotonete e toque CADA cochonilha. Verifique todas as dobras do caudex. √Ålcool mata instantaneamente.',
                  frequency: 'Diariamente por 2 semanas'
                },
                {
                  name: '√ìleo Mineral + Detergente',
                  recipe: '2 colheres de √≥leo mineral + 1 colher de detergente + 1L √°gua',
                  steps: 'Misture e borrife. O √≥leo sufoca cochonilhas. CUIDADO: n√£o aplique sob sol forte.',
                  frequency: 'A cada 5 dias por 3 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Inseticida Sist√™mico',
                  price: 'R$ 20-35',
                  usage: 'Aplicar no solo. Rosa absorve e mata cochonilhas de dentro.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          pulgoes_rosa_deserto: {
            name: 'Pulg√µes em Rosa do Deserto',
            severity: 'medium',
            cause: 'Pulg√µes atacam flores e brotos novos',
            symptoms: ['Insetos verdes/pretos nas flores', 'Flores deformadas', 'Bot√µes n√£o abrem', 'Formigas na planta'],
            treatments: {
              free: [
                {
                  name: 'Jato de √Ågua Suave',
                  recipe: '√Ågua',
                  steps: 'Use jato SUAVE (rosa do deserto √© delicada). Remova pulg√µes das flores. Fa√ßa pela manh√£.',
                  frequency: 'A cada 2 dias por 1 semana'
                },
                {
                  name: 'Sab√£o Neutro Dilu√≠do',
                  recipe: '1 colher de ch√° de sab√£o + 1L √°gua',
                  steps: 'Borrife levemente. Enx√°gue ap√≥s 20 minutos. N√£o encharque!',
                  frequency: 'A cada 3 dias'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Dilua bem. Aplique √† noite. Muito eficaz para rosa do deserto.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          acaros_rosa_deserto: {
            name: '√Åcaros em Rosa do Deserto',
            severity: 'medium',
            cause: '√Åcaros proliferam em clima seco e quente',
            symptoms: ['Folhas com pontos amarelos', 'Folhas secas', 'Teias finas', 'Crescimento atrofiado'],
            treatments: {
              free: [
                {
                  name: 'Aumentar Umidade do Ar',
                  recipe: '√Ågua + borrifador',
                  steps: 'Borrife LEVEMENTE ao redor (n√£o nas folhas). Coloque prato com √°gua perto. √Åcaros odeiam umidade.',
                  frequency: 'Diariamente'
                },
                {
                  name: 'Limpeza com √Ågua',
                  recipe: '√Ågua + pano macio',
                  steps: 'Limpe cada folha delicadamente. Remove √°caros e ovos.',
                  frequency: 'A cada 3 dias por 2 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Acaricida Espec√≠fico',
                  price: 'R$ 25-40',
                  usage: 'Use dose reduzida. Aplique √† noite.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          tripes_rosa_deserto: {
            name: 'Tripes em Rosa do Deserto',
            severity: 'medium',
            cause: 'Insetos que danificam flores e bot√µes',
            symptoms: ['Flores deformadas', 'Manchas prateadas nas p√©talas', 'Bot√µes n√£o abrem', 'Pontos pretos (fezes)'],
            treatments: {
              free: [
                {
                  name: 'Armadilha Adesiva Azul',
                  recipe: 'Papel azul + √≥leo/mel',
                  steps: 'Coloque perto das flores. Tripes s√£o atra√≠dos por azul e grudam.',
                  frequency: 'Trocar a cada 3 dias'
                },
                {
                  name: 'Sab√£o Neutro',
                  recipe: '1 colher de ch√° de sab√£o + 1L √°gua',
                  steps: 'Borrife nas flores. Enx√°gue ap√≥s 30 minutos.',
                  frequency: 'A cada 3 dias durante flora√ß√£o'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Muito eficaz contra tripes. Aplicar √† noite.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          }
        },
        caule: {
          mole: {
            name: 'Podrid√£o do Caudex',
            severity: 'high',
            cause: 'Excesso de √°gua causando apodrecimento do caule',
            symptoms: ['Caule mole ao toque', 'Manchas escuras no caudex', 'Mau cheiro'],
            treatments: {
              free: [
                {
                  name: 'Cirurgia de Emerg√™ncia',
                  recipe: 'Faca afiada + √°lcool 70% + canela em p√≥',
                  steps: 'URGENTE: Corte TODA a parte podre at√© encontrar tecido saud√°vel (branco/verde). Esterilize a faca com √°lcool entre cortes. Polvilhe canela na ferida. Deixe secar ao ar por 3-5 dias antes de replantar.',
                  frequency: 'A√ß√£o √∫nica de emerg√™ncia'
                }
              ],
              cheap: [
                {
                  name: 'Fungicida Sist√™mico',
                  price: 'R$ 15-25',
                  usage: 'Ap√≥s a cirurgia, aplique fungicida para prevenir nova infec√ß√£o.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          }
        }
      },
      suculenta: {
        folhas: {
          murchas: {
            name: 'Falta de √Ågua',
            severity: 'low',
            cause: 'Suculentas armazenam √°gua, mas ainda precisam de regas ocasionais',
            symptoms: ['Folhas enrugadas', 'Folhas moles', 'Perda de cor'],
            treatments: {
              free: [
                {
                  name: 'Rega Profunda',
                  recipe: '√Ågua',
                  steps: 'Regue abundantemente at√© a √°gua sair pelos furos. Depois, N√ÉO regue novamente at√© o solo secar COMPLETAMENTE (teste com o dedo).',
                  frequency: 'A cada 7-14 dias (depende do clima)'
                }
              ],
              cheap: []
            }
          },
          transparentes: {
            name: 'Excesso de √Ågua',
            severity: 'high',
            cause: 'C√©lulas das folhas estourando por excesso de √°gua',
            symptoms: ['Folhas transparentes/transl√∫cidas', 'Folhas moles e aguadas', 'Caindo facilmente'],
            treatments: {
              free: [
                {
                  name: 'Parar Rega e Drenar',
                  recipe: 'Sem ingredientes',
                  steps: 'Pare de regar imediatamente. Remova do vaso e deixe as ra√≠zes secarem ao ar por 2-3 dias. Replante em substrato seco e drenante.',
                  frequency: 'A√ß√£o √∫nica'
                }
              ],
              cheap: [
                {
                  name: 'Substrato para Suculentas',
                  price: 'R$ 8-15',
                  usage: 'Use substrato espec√≠fico para suculentas com excelente drenagem.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          alongadas: {
            name: 'Estiolamento (Falta de Luz)',
            severity: 'medium',
            cause: 'Planta esticando em busca de luz',
            symptoms: ['Caule alongado e fino', 'Folhas espa√ßadas', 'Crescimento para um lado'],
            treatments: {
              free: [
                {
                  name: 'Mais Luz Solar',
                  recipe: 'Sem ingredientes',
                  steps: 'Mova para local com mais luz (4-6h de sol direto). Gire o vaso semanalmente para crescimento uniforme. Partes estioladas n√£o voltam ao normal, mas novo crescimento ser√° saud√°vel.',
                  frequency: 'Permanente'
                }
              ],
              cheap: []
            }
          },
          cochonilhas_suculenta: {
            name: 'Cochonilhas em Suculentas',
            severity: 'high',
            cause: 'Insetos que se escondem entre folhas carnudas',
            symptoms: ['Insetos brancos tipo algod√£o', 'Subst√¢ncia pegajosa', 'Folhas deformadas', 'Crescimento atrofiado'],
            treatments: {
              free: [
                {
                  name: '√Ålcool Isoprop√≠lico 70%',
                  recipe: '√Ålcool 70% + cotonete ou pincel',
                  steps: 'Molhe cotonete no √°lcool e toque DIRETAMENTE em cada cochonilha. Verifique entre as folhas e na base. Repita diariamente.',
                  frequency: 'Diariamente por 2 semanas'
                },
                {
                  name: 'Jato de √Ågua Forte',
                  recipe: '√Ågua',
                  steps: 'Use jato forte para remover cochonilhas. Deixe a planta secar completamente antes de regar novamente.',
                  frequency: 'A cada 3 dias'
                }
              ],
              cheap: [
                {
                  name: 'Inseticida Sist√™mico',
                  price: 'R$ 20-35',
                  usage: 'Espec√≠fico para suculentas. Mata de dentro para fora.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          pulgoes_suculenta: {
            name: 'Pulg√µes em Suculentas',
            severity: 'medium',
            cause: 'Pulg√µes atacam brotos novos e flores',
            symptoms: ['Insetos verdes/pretos nos brotos', 'Flores deformadas', 'Subst√¢ncia pegajosa', 'Formigas na planta'],
            treatments: {
              free: [
                {
                  name: 'Jato de √Ågua',
                  recipe: '√Ågua',
                  steps: 'Jato forte de √°gua remove pulg√µes. CUIDADO: n√£o encharque a suculenta. Deixe secar bem.',
                  frequency: 'A cada 2 dias por 1 semana'
                },
                {
                  name: 'Sab√£o Neutro Dilu√≠do',
                  recipe: '1 colher de ch√° de sab√£o + 1 litro de √°gua',
                  steps: 'Borrife levemente. Enx√°gue ap√≥s 30 minutos. Deixe secar completamente.',
                  frequency: 'A cada 3 dias'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Dilua bem (menos concentrado para suculentas). Aplique √† noite.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          acaros_suculenta: {
            name: '√Åcaros em Suculentas',
            severity: 'medium',
            cause: '√Åcaros proliferam em ambientes secos',
            symptoms: ['Manchas marrons nas folhas', 'Teias finas', 'Folhas secas', 'Crescimento deformado'],
            treatments: {
              free: [
                {
                  name: 'Aumentar Umidade do Ar',
                  recipe: '√Ågua + borrifador',
                  steps: 'Borrife LEVEMENTE ao redor (n√£o nas folhas). Coloque prato com √°gua perto. √Åcaros odeiam umidade.',
                  frequency: 'Diariamente'
                },
                {
                  name: 'Limpeza com √Ågua',
                  recipe: '√Ågua + pano macio',
                  steps: 'Limpe cada folha delicadamente com pano √∫mido. Remove √°caros e ovos.',
                  frequency: 'A cada 3 dias por 2 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Acaricida Espec√≠fico',
                  price: 'R$ 25-40',
                  usage: 'Use dose reduzida para suculentas. Aplique √† noite.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          lesmas_caracois: {
            name: 'Lesmas e Carac√≥is',
            severity: 'medium',
            cause: 'Moluscos que comem folhas carnudas √† noite',
            symptoms: ['Buracos irregulares nas folhas', 'Trilhas de baba prateada', 'Folhas comidas', 'Presen√ßa de lesmas/carac√≥is'],
            treatments: {
              free: [
                {
                  name: 'Cata√ß√£o Noturna',
                  recipe: 'Lanterna + luvas',
                  steps: 'Saia √† noite com lanterna e remova manualmente. Eles s√£o mais ativos ap√≥s o p√¥r do sol.',
                  frequency: 'Todas as noites por 1 semana'
                },
                {
                  name: 'Barreira de Casca de Ovo',
                  recipe: 'Cascas de ovo trituradas',
                  steps: 'Espalhe cascas trituradas ao redor da planta. As bordas afiadas impedem lesmas de passar.',
                  frequency: 'Reponha ap√≥s chuva'
                },
                {
                  name: 'Armadilha de Cerveja',
                  recipe: 'Pote raso + cerveja',
                  steps: 'Enterre pote at√© a borda, encha com cerveja. Lesmas s√£o atra√≠das e se afogam.',
                  frequency: 'Trocar a cada 2 dias'
                }
              ],
              cheap: [
                {
                  name: 'Iscas para Lesmas',
                  price: 'R$ 12-20',
                  usage: 'Coloque ao redor das plantas. CUIDADO com pets!',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          }
        }
      },
      frutifera: {
        folhas: {
          amarelas_nervuras_verdes: {
            name: 'Clorose F√©rrica (Falta de Ferro)',
            severity: 'medium',
            cause: 'Defici√™ncia de ferro, comum em solos alcalinos',
            symptoms: ['Folhas amarelas com nervuras verdes', 'Folhas novas mais afetadas', 'Crescimento lento'],
            treatments: {
              free: [
                {
                  name: 'Pregos Enferrujados',
                  recipe: '5-10 pregos velhos enferrujados',
                  steps: 'Enterre os pregos ao redor da planta (10cm de profundidade). O ferro vai sendo liberado lentamente. Ou fa√ßa "ch√°": deixe pregos em 1L de √°gua por 1 semana, depois regue.',
                  frequency: 'A cada 2 meses'
                },
                {
                  name: 'Vinagre Dilu√≠do',
                  recipe: '1 colher de sopa de vinagre branco + 1 litro de √°gua',
                  steps: 'Acidifica o solo, ajudando a planta absorver ferro. Regue com essa mistura.',
                  frequency: 'A cada 15 dias'
                }
              ],
              cheap: [
                {
                  name: 'Sulfato Ferroso',
                  price: 'R$ 8-15',
                  usage: 'Fonte direta de ferro. Dilua conforme instru√ß√µes e aplique no solo.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          manchas_marrons: {
            name: 'Queima de Sol',
            severity: 'low',
            cause: 'Exposi√ß√£o s√∫bita a sol muito forte',
            symptoms: ['Manchas marrons secas', 'Bordas queimadas', 'Folhas crocantes'],
            treatments: {
              free: [
                {
                  name: 'Sombreamento Parcial',
                  recipe: 'Tela de sombreamento ou len√ßol',
                  steps: 'Proteja do sol das 11h √†s 15h (hor√°rio mais forte). Acostume gradualmente ao sol pleno.',
                  frequency: 'At√© a planta se adaptar (2-3 semanas)'
                }
              ],
              cheap: [
                {
                  name: 'Tela de Sombreamento 50%',
                  price: 'R$ 15-30',
                  usage: 'Instale sobre a planta para filtrar 50% da luz solar.',
                  where: 'Lojas de jardinagem ou constru√ß√£o'
                }
              ]
            }
          },
          pulgoes_frutifera: {
            name: 'Pulg√µes em Frut√≠feras',
            severity: 'high',
            cause: 'Pulg√µes sugam seiva e transmitem viroses',
            symptoms: ['Insetos verdes/pretos em brotos', 'Folhas enroladas', 'Formigas subindo no tronco', 'Melado nas folhas'],
            treatments: {
              free: [
                {
                  name: 'Jato de √Ågua Forte',
                  recipe: 'Mangueira com jato forte',
                  steps: 'Jato forte de √°gua pela manh√£. Foque nos brotos e embaixo das folhas. Repita diariamente.',
                  frequency: 'Diariamente por 1 semana'
                },
                {
                  name: 'Calda de Sab√£o e Alho',
                  recipe: '5 dentes de alho + 1 colher de sab√£o + 1L √°gua',
                  steps: 'Bata alho com √°gua, deixe 24h, coe, adicione sab√£o. Borrife generosamente.',
                  frequency: 'A cada 3 dias por 2 semanas'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Dilua 5ml em 1L √°gua. Borrife √† noite. Seguro para frut√≠feras.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          },
          cochonilhas_frutifera: {
            name: 'Cochonilhas em Frut√≠feras',
            severity: 'high',
            cause: 'Insetos que formam col√¥nias e sugam seiva',
            symptoms: ['Insetos brancos/marrons grudados', 'Fumagina (fungo preto)', 'Galhos fracos', 'Frutos deformados'],
            treatments: {
              free: [
                {
                  name: 'Escova + Sab√£o',
                  recipe: 'Escova macia + √°gua com sab√£o',
                  steps: 'Escove CADA galho infectado com √°gua e sab√£o. Remove cochonilhas mecanicamente. Use luvas.',
                  frequency: 'Semanalmente por 1 m√™s'
                },
                {
                  name: '√ìleo Vegetal + Detergente',
                  recipe: '2 colheres de √≥leo vegetal + 1 colher de detergente + 1L √°gua',
                  steps: 'Misture bem e borrife. O √≥leo sufoca as cochonilhas. Aplique √† tarde.',
                  frequency: 'A cada 5 dias por 3 semanas'
                }
              ],
              cheap: [
                {
                  name: 'Inseticida Sist√™mico',
                  price: 'R$ 20-35',
                  usage: 'Aplicar no solo. A planta absorve e mata cochonilhas de dentro.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          mosca_frutas: {
            name: 'Mosca das Frutas',
            severity: 'high',
            cause: 'Moscas depositam ovos nos frutos, larvas comem por dentro',
            symptoms: ['Furos pequenos nos frutos', 'Frutos apodrecendo prematuramente', 'Larvas brancas dentro', 'Moscas ao redor'],
            treatments: {
              free: [
                {
                  name: 'Ensacamento de Frutos',
                  recipe: 'Sacos de papel ou TNT',
                  steps: 'Ensaque CADA fruto quando pequeno (tamanho de azeitona). Amarre bem. Moscas n√£o conseguem pousar.',
                  frequency: 'Manter at√© colheita'
                },
                {
                  name: 'Armadilha com Vinagre',
                  recipe: 'Garrafa PET + vinagre de ma√ß√£ + a√ß√∫car',
                  steps: 'Corte garrafa, coloque vinagre + a√ß√∫car. Moscas entram e n√£o saem. Pendure na √°rvore.',
                  frequency: 'Trocar semanalmente'
                },
                {
                  name: 'Coleta de Frutos Ca√≠dos',
                  recipe: 'Sem ingredientes',
                  steps: 'Recolha TODOS os frutos ca√≠dos DIARIAMENTE. Enterre longe ou descarte no lixo. Quebra o ciclo.',
                  frequency: 'Diariamente'
                }
              ],
              cheap: [
                {
                  name: 'Armadilha McPhail',
                  price: 'R$ 25-45',
                  usage: 'Armadilha profissional com atrativo. Muito eficaz.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          acaros_frutifera: {
            name: '√Åcaros em Frut√≠feras',
            severity: 'medium',
            cause: '√Åcaros microsc√≥picos que causam bronzeamento',
            symptoms: ['Folhas bronzeadas', 'Folhas secas', 'Teias finas', 'Queda prematura de folhas'],
            treatments: {
              free: [
                {
                  name: 'Aumentar Umidade',
                  recipe: '√Ågua + mangueira',
                  steps: 'Molhe a copa da √°rvore 2x ao dia (manh√£ e tarde). √Åcaros odeiam umidade.',
                  frequency: '2x ao dia por 2 semanas'
                },
                {
                  name: 'Enxofre Molh√°vel Caseiro',
                  recipe: 'Enxofre em p√≥ (farm√°cia) + √°gua',
                  steps: 'Misture 1 colher de enxofre em 1L √°gua. Borrife nas folhas. CUIDADO: n√£o use em dias quentes (acima 30¬∞C).',
                  frequency: 'A cada 7 dias'
                }
              ],
              cheap: [
                {
                  name: 'Acaricida Espec√≠fico',
                  price: 'R$ 25-40',
                  usage: 'Inseticidas comuns n√£o funcionam. Use acaricida espec√≠fico.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          lagartas_frutifera: {
            name: 'Lagartas em Frut√≠feras',
            severity: 'high',
            cause: 'Larvas que comem folhas e frutos',
            symptoms: ['Folhas comidas', 'Buracos nos frutos', 'Fezes escuras', 'Presen√ßa de lagartas'],
            treatments: {
              free: [
                {
                  name: 'Cata√ß√£o Manual',
                  recipe: 'Luvas',
                  steps: 'Procure lagartas de manh√£ cedo. Remova e descarte. Verifique embaixo das folhas e dentro dos frutos.',
                  frequency: 'Diariamente por 2 semanas'
                },
                {
                  name: 'Ch√° de Folhas de Tomate',
                  recipe: '2 x√≠caras de folhas de tomate + 2 x√≠caras de √°gua',
                  steps: 'Ferva as folhas, deixe esfriar, coe e borrife. T√≥xico para lagartas, seguro para humanos.',
                  frequency: 'A cada 5 dias'
                }
              ],
              cheap: [
                {
                  name: 'Bacillus thuringiensis (Bt)',
                  price: 'R$ 15-25',
                  usage: 'Inseticida biol√≥gico. Mata s√≥ lagartas. Seguro para abelhas e humanos.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          formigas_cortadeiras: {
            name: 'Formigas Cortadeiras (Sa√∫vas)',
            severity: 'high',
            cause: 'Formigas que cortam folhas para cultivar fungo',
            symptoms: ['Folhas cortadas em c√≠rculos', 'Trilhas de formigas', 'Desfolhamento r√°pido', 'Olheiros (entradas do formigueiro)'],
            treatments: {
              free: [
                {
                  name: '√Ågua Fervente nos Olheiros',
                  recipe: '√Ågua fervente',
                  steps: 'Despeje √°gua fervente diretamente nos olheiros. Fa√ßa √† noite quando todas est√£o dentro. CUIDADO para n√£o se queimar.',
                  frequency: 'Repetir se necess√°rio'
                },
                {
                  name: 'Barreira de Vaselina',
                  recipe: 'Vaselina ou graxa',
                  steps: 'Passe vaselina ao redor do tronco (faixa de 10cm). Formigas n√£o conseguem passar.',
                  frequency: 'Reponha mensalmente'
                },
                {
                  name: 'Folhas de Gergelim',
                  recipe: 'Folhas de gergelim',
                  steps: 'Plante gergelim ao redor. Formigas levam as folhas mas o fungo morre. Elas abandonam o local.',
                  frequency: 'Permanente'
                }
              ],
              cheap: [
                {
                  name: 'Isca Formicida Granulada',
                  price: 'R$ 15-30',
                  usage: 'Espalhe ao redor dos olheiros. Formigas levam para dentro e mata a col√¥nia.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          },
          tripes_frutifera: {
            name: 'Tripes em Frut√≠feras',
            severity: 'medium',
            cause: 'Insetos min√∫sculos que danificam flores e frutos',
            symptoms: ['Flores deformadas', 'Frutos com cicatrizes', 'Manchas prateadas', 'Frutos rachados'],
            treatments: {
              free: [
                {
                  name: 'Armadilha Adesiva Azul',
                  recipe: 'Papel azul + √≥leo/mel',
                  steps: 'Pendure pap√©is azuis com √≥leo na √°rvore. Tripes s√£o atra√≠dos e grudam.',
                  frequency: 'Trocar a cada 3 dias'
                },
                {
                  name: 'Sab√£o de Pot√°ssio',
                  recipe: '2 colheres de sab√£o neutro + 1L √°gua',
                  steps: 'Borrife nas flores e frutos jovens. Mata tripes por contato.',
                  frequency: 'A cada 3 dias durante flora√ß√£o'
                }
              ],
              cheap: [
                {
                  name: '√ìleo de Neem',
                  price: 'R$ 18-30',
                  usage: 'Muito eficaz contra tripes. Aplicar √† noite durante flora√ß√£o.',
                  where: 'Lojas de jardinagem'
                }
              ]
            }
          }
        },
        flores: {
          caindo: {
            name: 'Queda de Flores/Frutos',
            severity: 'medium',
            cause: 'Estresse h√≠drico, falta de poliniza√ß√£o ou defici√™ncia nutricional',
            symptoms: ['Flores caem antes de formar frutos', 'Frutos pequenos caem', 'Poucas flores'],
            treatments: {
              free: [
                {
                  name: 'Rega Consistente',
                  recipe: '√Ågua',
                  steps: 'Mantenha solo uniformemente √∫mido durante flora√ß√£o e frutifica√ß√£o. N√£o deixe secar completamente nem encharcar.',
                  frequency: '2-3x por semana'
                },
                {
                  name: 'Poliniza√ß√£o Manual',
                  recipe: 'Pincel pequeno',
                  steps: 'Use pincel macio para transferir p√≥len entre flores. Fa√ßa pela manh√£ quando flores est√£o abertas.',
                  frequency: 'Diariamente durante flora√ß√£o'
                },
                {
                  name: 'Casca de Ovo (C√°lcio)',
                  recipe: 'Cascas de 5-6 ovos',
                  steps: 'Lave e seque as cascas. Triture at√© virar p√≥. Misture no solo ao redor da planta. C√°lcio previne queda de frutos.',
                  frequency: 'A cada m√™s'
                }
              ],
              cheap: [
                {
                  name: 'Adubo para Frut√≠feras',
                  price: 'R$ 12-25',
                  usage: 'Rico em pot√°ssio e f√≥sforo. Aplique conforme instru√ß√µes durante flora√ß√£o.',
                  where: 'Lojas agropecu√°rias'
                }
              ]
            }
          }
        }
      }
    };

    // Symptom options for each affected part
    const symptomOptions = {
      folhas: [
        'Folhas amarelas come√ßando de baixo',
        'Manchas pretas circulares',
        'Pequenos insetos verdes/pretos',
        'P√≥ branco nas folhas',
        'Folhas enroladas',
        'Folhas caindo facilmente',
        'Folhas murchas/enrugadas',
        'Folhas transparentes',
        'Caule alongado e fino',
        'Folhas amarelas com nervuras verdes',
        'Manchas marrons secas',
        'Bordas queimadas'
      ],
      caule: [
        'Caule mole ao toque',
        'Manchas escuras',
        'Mau cheiro',
        'Caule fino e fraco',
        'Crescimento lento'
      ],
      flores: [
        'Bot√µes n√£o abrem',
        'Bot√µes secam antes de abrir',
        'Flores caem rapidamente',
        'Poucas flores',
        'Flores deformadas'
      ],
      raiz: [
        'Ra√≠zes marrons/pretas',
        'Ra√≠zes moles',
        'Mau cheiro no solo',
        'Solo sempre √∫mido',
        'Planta solta no vaso'
      ]
    };

    // Element SDK Integration
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          document.getElementById('siteTitle').textContent = config.site_title || defaultConfig.site_title;
          renderGallery();
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["site_title", config.site_title || defaultConfig.site_title],
          ["empty_message", config.empty_message || defaultConfig.empty_message],
          ["add_button_text", config.add_button_text || defaultConfig.add_button_text]
        ])
      });
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('plantDate').value = today;
      document.getElementById('eventDate').value = today;
      renderGallery();
    });

    // Page Navigation
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      
      if (pageId === 'homePage') {
        renderGallery();
      } else if (pageId === 'diagnosisPage') {
        resetDiagnosis();
      }
    }

    // Gallery Rendering
    function renderGallery() {
      const container = document.getElementById('galleryContainer');
      
      if (plants.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üå±</div>
            <div class="empty-message">${config.empty_message || defaultConfig.empty_message}</div>
            <button class="btn-primary" onclick="showAddPlantModal()">${config.add_button_text || defaultConfig.add_button_text}</button>
          </div>
        `;
        return;
      }

      const gallery = document.createElement('div');
      gallery.className = 'gallery';

      plants.forEach(plant => {
        const age = calculateAge(plant.plantDate);
        const card = document.createElement('div');
        card.className = 'plant-card';
        card.onclick = () => showPlantDetail(plant.id);
        
        card.innerHTML = `
          <img src="${plant.photo}" alt="${plant.name}">
          <div class="plant-card-overlay">
            <div class="plant-name">${plant.name}</div>
            <div class="plant-age">${age}</div>
          </div>
        `;
        
        gallery.appendChild(card);
      });

      container.innerHTML = '';
      container.appendChild(gallery);
    }

    // Calculate Plant Age
    function calculateAge(plantDate) {
      const start = new Date(plantDate);
      const now = new Date();
      const diffTime = Math.abs(now - start);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays < 30) {
        return `${diffDays} dias`;
      } else if (diffDays < 365) {
        const months = Math.floor(diffDays / 30);
        return `${months} ${months === 1 ? 'm√™s' : 'meses'}`;
      } else {
        const years = Math.floor(diffDays / 365);
        const months = Math.floor((diffDays % 365) / 30);
        return `${years} ${years === 1 ? 'ano' : 'anos'}${months > 0 ? ` e ${months} ${months === 1 ? 'm√™s' : 'meses'}` : ''}`;
      }
    }

    // Modal Functions
    function showAddPlantModal() {
      document.getElementById('addPlantModal').classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      if (modalId === 'addPlantModal') {
        document.getElementById('addPlantForm').reset();
        document.getElementById('plantPhotoPreview').style.display = 'none';
      } else if (modalId === 'addEventModal') {
        document.getElementById('addEventForm').reset();
        document.getElementById('eventPhotoPreview').style.display = 'none';
      }
    }

    // Photo Preview
    function previewPhoto(input, previewId) {
      const preview = document.getElementById(previewId);
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    // Add Plant
    function addPlant(event) {
      event.preventDefault();
      
      const photoInput = document.getElementById('plantPhoto');
      if (!photoInput.files || !photoInput.files[0]) {
        showToast('Por favor, adicione uma foto da planta');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const plant = {
          id: Date.now().toString(),
          name: document.getElementById('plantName').value,
          plantDate: document.getElementById('plantDate').value,
          notes: document.getElementById('plantNotes').value,
          photo: e.target.result,
          events: []
        };

        plants.push(plant);
        localStorage.setItem('myGardenPlants', JSON.stringify(plants));
        
        closeModal('addPlantModal');
        renderGallery();
        showToast('Planta adicionada com sucesso! üå±');
      };
      reader.readAsDataURL(photoInput.files[0]);
    }

    // Show Plant Detail
    function showPlantDetail(plantId) {
      currentPlantId = plantId;
      const plant = plants.find(p => p.id === plantId);
      if (!plant) return;

      const age = calculateAge(plant.plantDate);
      const content = document.getElementById('plantDetailContent');

      const sortedEvents = [...plant.events].sort((a, b) => new Date(b.date) - new Date(a.date));

      content.innerHTML = `
        <div class="plant-detail-header">
          <img src="${plant.photo}" alt="${plant.name}">
          <div class="plant-detail-info">
            <div class="plant-detail-name">${plant.name}</div>
            <div class="plant-detail-meta">
              <span>üìÖ Plantada em ${new Date(plant.plantDate).toLocaleDateString('pt-BR')}</span>
              <span>üå± ${age}</span>
            </div>
          </div>
        </div>

        ${plant.notes ? `<div style="background: white; padding: 16px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
          <strong style="color: #8B5CF6;">Observa√ß√µes:</strong>
          <p style="margin-top: 8px; color: #666;">${plant.notes}</p>
        </div>` : ''}

        <h3 class="section-title">
          <svg class="icon-outline" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          Timeline de Eventos
        </h3>

        ${sortedEvents.length === 0 ? `
          <div style="text-align: center; padding: 40px; color: #666;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
            <p>Nenhum evento registrado ainda</p>
          </div>
        ` : `
          <div class="timeline">
            ${sortedEvents.map(event => `
              <div class="timeline-item">
                <div class="timeline-date">${new Date(event.date).toLocaleDateString('pt-BR')}</div>
                <div class="timeline-type">${getEventIcon(event.type)} ${getEventName(event.type)}</div>
                <div class="timeline-description">${event.description}</div>
                ${event.photo ? `<img src="${event.photo}" class="timeline-photo" alt="Foto do evento">` : ''}
              </div>
            `).join('')}
          </div>
        `}
      `;

      showPage('plantDetailPage');
    }

    // Event Type Helpers
    function getEventIcon(type) {
      const icons = {
        poda: 'üåø',
        vaso: 'ü™¥',
        adubo: 'üå±',
        rega: 'üíß',
        problema: '‚ö†Ô∏è',
        foto: 'üì∏',
        nota: 'üìù'
      };
      return icons[type] || 'üìù';
    }

    function getEventName(type) {
      const names = {
        poda: 'Poda',
        vaso: 'Troca de Vaso',
        adubo: 'Aduba√ß√£o',
        rega: 'Rega Especial',
        problema: 'Problema Detectado',
        foto: 'Foto de Desenvolvimento',
        nota: 'Nota Geral'
      };
      return names[type] || 'Evento';
    }

    // Add Event
    function showAddEventModal() {
      if (!currentPlantId) return;
      document.getElementById('addEventModal').classList.add('active');
    }

    function addEvent(event) {
      event.preventDefault();
      
      const plant = plants.find(p => p.id === currentPlantId);
      if (!plant) return;

      const photoInput = document.getElementById('eventPhoto');
      
      const processEvent = (photoData) => {
        const newEvent = {
          id: Date.now().toString(),
          type: document.getElementById('eventType').value,
          date: document.getElementById('eventDate').value,
          description: document.getElementById('eventDescription').value,
          photo: photoData
        };

        plant.events.push(newEvent);
        localStorage.setItem('myGardenPlants', JSON.stringify(plants));
        
        closeModal('addEventModal');
        showPlantDetail(currentPlantId);
        showToast('Evento adicionado com sucesso! ‚úÖ');
      };

      if (photoInput.files && photoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => processEvent(e.target.result);
        reader.readAsDataURL(photoInput.files[0]);
      } else {
        processEvent(null);
      }
    }

    // Diagnosis Functions
    function resetDiagnosis() {
      document.getElementById('problemDescription').value = '';
      document.getElementById('problemPhoto').value = '';
      document.getElementById('problemPhotoPreview').style.display = 'none';
      document.getElementById('diagnosisResult').innerHTML = '';
    }

    function analyzeFreeTextDiagnosis() {
      const description = document.getElementById('problemDescription').value.trim();
      
      if (!description) {
        showToast('Por favor, descreva o problema da sua planta');
        return;
      }

      // Show loading state
      const resultDiv = document.getElementById('diagnosisResult');
      resultDiv.innerHTML = `
        <div style="text-align: center; padding: 40px; background: white; border-radius: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
          <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
          <p style="color: #666;">Analisando sintomas...</p>
        </div>
      `;

      // Simulate AI processing
      setTimeout(() => {
        const diagnosis = matchDescriptionToProblem(description);
        displayDiagnosisResult(diagnosis);
      }, 1500);
    }

    function matchDescriptionToProblem(description) {
      const descLower = description.toLowerCase();
      
      // Detect plant type from description
      let plantType = null;
      if (descLower.includes('rosa do deserto') || descLower.includes('adenium')) {
        plantType = 'rosa_deserto';
      } else if (descLower.includes('rosa')) {
        plantType = 'rosa';
      } else if (descLower.includes('suculenta') || descLower.includes('cacto')) {
        plantType = 'suculenta';
      } else if (descLower.includes('frutifera') || descLower.includes('frut√≠fera') || descLower.includes('fruto') || descLower.includes('laranja') || descLower.includes('lim√£o') || descLower.includes('manga') || descLower.includes('goiaba')) {
        plantType = 'frutifera';
      }
      
      // Keywords for matching
      const keywords = {
        excesso_agua: ['amarela', 'amarelada', 'caindo', '√∫mido', 'encharcado', 'molhado', 'apodrecendo', 'mole'],
        mancha_preta: ['mancha preta', 'manchas pretas', 'ponto preto', 'pontos pretos', 'fungo'],
        pulgao: ['pulg√£o', 'pulgao', 'inseto verde', 'inseto preto', 'formiga', 'pegajoso', 'melado'],
        cochonilha: ['cochonilha', 'algod√£o', 'branco grudado', 'inseto branco'],
        acaro: ['pontos amarelos', 'teia', 'seca', 'prateada', 'bronzeada'],
        lagarta: ['buraco', 'comida', 'lagarta', 'folha comida'],
        oideo: ['p√≥ branco', 'mofo branco', 'branco nas folhas'],
        mosca_branca: ['mosca branca', 'mosquinha branca', 'nuvem de insetos'],
        falta_luz: ['alongada', 'esticada', 'fina', 'fraca', 'crescendo torto'],
        falta_agua: ['murcha', 'enrugada', 'seca'],
        queima_sol: ['queimada', 'marrom seca', 'crocante'],
        clorose: ['amarela com nervura verde', 'nervura verde'],
        podridao: ['caule mole', 'mau cheiro', 'podre'],
        mosca_fruta: ['fruto furado', 'larva no fruto', 'fruto apodrecendo'],
        formiga: ['formiga cortadeira', 'sa√∫va', 'folha cortada em c√≠rculo'],
        tripes: ['flor deformada', 'mancha prateada', 'ponto preto pequeno'],
        lesma: ['buraco irregular', 'baba', 'lesma', 'caracol']
      };

      let bestMatch = null;
      let maxScore = 0;

      // Search through all plant types if not specified
      const plantsToSearch = plantType ? [plantType] : ['rosa', 'rosa_deserto', 'suculenta', 'frutifera'];

      for (const plant of plantsToSearch) {
        const plantData = knowledgeBase[plant];
        if (!plantData) continue;

        for (const part of Object.keys(plantData)) {
          for (const [key, problem] of Object.entries(plantData[part])) {
            let score = 0;

            // Check problem symptoms
            problem.symptoms.forEach(symptom => {
              if (descLower.includes(symptom.toLowerCase())) {
                score += 3;
              }
            });

            // Check keywords
            for (const [keywordType, words] of Object.entries(keywords)) {
              words.forEach(word => {
                if (descLower.includes(word)) {
                  score += 2;
                }
              });
            }

            // Check problem name and cause
            if (descLower.includes(problem.name.toLowerCase())) {
              score += 5;
            }
            if (descLower.includes(problem.cause.toLowerCase())) {
              score += 3;
            }

            if (score > maxScore) {
              maxScore = score;
              bestMatch = problem;
            }
          }
        }
      }

      // If no good match, return a generic response
      if (!bestMatch || maxScore < 2) {
        return {
          name: 'Problema N√£o Identificado',
          severity: 'medium',
          cause: 'N√£o foi poss√≠vel identificar o problema espec√≠fico com base na descri√ß√£o fornecida.',
          symptoms: ['Sintomas variados'],
          treatments: {
            free: [
              {
                name: 'Observa√ß√£o Detalhada',
                recipe: 'Sem ingredientes',
                steps: 'Observe sua planta diariamente. Anote: cor das folhas, textura do caule, frequ√™ncia de rega, quantidade de luz solar, presen√ßa de insetos. Com mais detalhes, podemos fazer um diagn√≥stico melhor.',
                frequency: 'Diariamente'
              },
              {
                name: 'Cuidados B√°sicos',
                recipe: '√Ågua + luz adequada',
                steps: 'Verifique se a planta est√° recebendo luz adequada (4-6h de sol para maioria). Regue apenas quando o solo estiver seco ao toque. Remova folhas mortas.',
                frequency: 'Conforme necess√°rio'
              }
            ],
            cheap: [
              {
                name: 'Consulta em Loja Especializada',
                price: 'Gratuito',
                usage: 'Tire uma foto clara do problema e leve a uma loja de jardinagem. Eles podem ajudar com diagn√≥stico presencial.',
                where: 'Lojas de jardinagem locais'
              }
            ]
          }
        };
      }

      return bestMatch;
    }

    function displayDiagnosisResult(diagnosis) {
      const resultDiv = document.getElementById('diagnosisResult');
      
      resultDiv.innerHTML = `
        <div class="diagnosis-result">
          <h3 style="font-size: 24px; color: #333; margin-bottom: 12px;">${diagnosis.name}</h3>
          <span class="severity-badge severity-${diagnosis.severity}">
            ${diagnosis.severity === 'low' ? 'Gravidade Baixa' : diagnosis.severity === 'medium' ? 'Gravidade M√©dia' : 'Gravidade Alta'}
          </span>

          <div style="margin-top: 20px;">
            <p style="margin-bottom: 12px;"><strong>Causa:</strong> ${diagnosis.cause}</p>
            <p><strong>Sintomas Comuns:</strong></p>
            <ul style="margin-left: 20px; margin-top: 8px; color: #666;">
              ${diagnosis.symptoms.map(s => `<li>${s}</li>`).join('')}
            </ul>
          </div>

          <div class="treatment-section">
            <div class="treatment-title">
              <svg class="icon-outline" viewBox="0 0 24 24">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
              Tratamentos Caseiros (Gratuitos)
            </div>
            ${diagnosis.treatments.free.map(t => `
              <div class="treatment-card">
                <div class="treatment-name">${t.name}</div>
                <p style="font-size: 13px; color: #8B5CF6; margin-bottom: 8px;"><strong>Receita:</strong> ${t.recipe}</p>
                <div class="treatment-steps">${t.steps}</div>
                <p style="font-size: 12px; color: #059669; margin-top: 8px;"><strong>Frequ√™ncia:</strong> ${t.frequency}</p>
              </div>
            `).join('')}
          </div>

          ${diagnosis.treatments.cheap.length > 0 ? `
            <div class="treatment-section">
              <div class="treatment-title">
                <svg class="icon-outline" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                Tratamentos Baratos
              </div>
              ${diagnosis.treatments.cheap.map(t => `
                <div class="treatment-card">
                  <div class="treatment-name">${t.name}</div>
                  <div class="treatment-price">${t.price}</div>
                  <div class="treatment-steps" style="margin-top: 8px;">${t.usage}</div>
                  <p style="font-size: 12px; color: #666; margin-top: 8px;"><strong>Onde comprar:</strong> ${t.where}</p>
                </div>
              `).join('')}
            </div>
          ` : ''}

          <div class="action-buttons">
            <button class="btn-secondary" onclick="resetDiagnosis()">
              Novo Diagn√≥stico
            </button>
            <button class="btn-primary" style="flex: 1;" onclick="saveDiagnosisToPlant('${diagnosis.name}')">
              Salvar na Planta
            </button>
          </div>
        </div>
      `;

      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function saveDiagnosisToPlant(problemName) {
      if (plants.length === 0) {
        showToast('Adicione uma planta primeiro!');
        return;
      }

      // Create inline selection UI
      const resultDiv = document.getElementById('diagnosisResult');
      const selectUI = document.createElement('div');
      selectUI.style.cssText = 'background: #f9fafb; padding: 20px; border-radius: 16px; margin-top: 20px;';
      selectUI.innerHTML = `
        <h4 style="margin-bottom: 16px; color: #333;">Selecione a planta:</h4>
        ${plants.map((p, i) => `
          <div class="option-card" style="margin-bottom: 8px; text-align: left;" onclick="confirmSaveDiagnosis(${i}, '${problemName}')">
            <strong>${p.name}</strong>
          </div>
        `).join('')}
        <button class="btn-secondary" style="width: 100%; margin-top: 12px;" onclick="this.parentElement.remove()">Cancelar</button>
      `;
      
      resultDiv.appendChild(selectUI);
    }

    function confirmSaveDiagnosis(plantIndex, problemName) {
      const plant = plants[plantIndex];
      const event = {
        id: Date.now().toString(),
        type: 'problema',
        date: new Date().toISOString().split('T')[0],
        description: `Diagn√≥stico: ${problemName}`,
        photo: null
      };
      
      plant.events.push(event);
      localStorage.setItem('myGardenPlants', JSON.stringify(plants));
      showToast('Diagn√≥stico salvo com sucesso! ‚úÖ');
      
      // Remove selection UI
      document.querySelectorAll('#diagnosisResult > div').forEach((div, i) => {
        if (i > 0) div.remove();
      });
    }

    function showInfoModal() {
      const infoHTML = `
        <div style="background: white; border-radius: 24px; padding: 24px; max-width: 400px; margin: 20px;">
          <h3 style="color: #8B5CF6; margin-bottom: 16px;">Sobre o My Garden</h3>
          <p style="color: #666; line-height: 1.6; margin-bottom: 16px;">
            Sistema inteligente de diagn√≥stico com base de conhecimento especializada em:
          </p>
          <ul style="color: #666; margin-left: 20px; margin-bottom: 16px;">
            <li>üåπ Rosas</li>
            <li>üå∫ Rosas do Deserto</li>
            <li>üåµ Suculentas</li>
            <li>üçä Plantas Frut√≠feras</li>
          </ul>
          <p style="color: #666; line-height: 1.6;">
            Todos os dados s√£o salvos localmente no seu navegador.
          </p>
          <button class="btn-primary" style="width: 100%; margin-top: 20px;" onclick="this.closest('div').remove()">Fechar</button>
        </div>
      `;
      
      const modal = document.createElement('div');
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 3000;';
      modal.innerHTML = infoHTML;
      modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
      document.body.appendChild(modal);
    }

    // Toast Notification
    function showToast(message) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(90deg, #8B5CF6 0%, #FCD34D 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 24px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        z-index: 9999;
        font-weight: 600;
        max-width: 90%;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.transition = 'opacity 0.3s';
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a032e04f523f16b',t:'MTc2MzQyMzk0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>